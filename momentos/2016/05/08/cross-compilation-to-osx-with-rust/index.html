    <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Cross compilation to OSX with Rust &middot; { always: &#39;coding&#39; } </title>
    
    <link rel="stylesheet" type="text/css" href="http://alwayscoding.ca//css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://alwayscoding.ca//css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://alwayscoding.ca/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="http://alwayscoding.ca/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="{ always: &#39;coding&#39; }" />
    
    <script src="http://alwayscoding.ca//js/jquery.min.js"></script>
    <script src="http://alwayscoding.ca//js/main.min.js">
    </script>
</head>

    <body>
        <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/side-column-bg.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://alwayscoding.ca//" title="link to homepage for { always: &#39;coding&#39; }"> <img src="http://www.gravatar.com/avatar/c15ec5b29cc5407a01bd17907e41230b?s=160" width="80" alt="{ always: &#39;coding&#39; } logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://alwayscoding.ca//"  title="link to homepage for { always: &#39;coding&#39; }">{ always: &#39;coding&#39; }</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  Brian Pearce  </p>
                <hr class="panel-cover__divider panel-cover__divider--secondary" />
                <div class="navigation-wrapper">
                    <nav class="cover-navigation cover-navigation--primary">
                        <ul class="navigation">
                            <li class="navigation__item"><a href="http://alwayscoding.ca/#blog" title="link to { always: &#39;coding&#39; } blog" class="blog-button">Blog</a> </li>
                            <li class="navigation__item"><a href="http://alwayscoding.ca/posts" title="The blog archive" class="blog-button">Archive</a> </li></br>
                            
                            
                       </ul>
                    </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/brian_pearce" title="@brian_pearce on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="http://no.linkedin.com/in/brian-pearce/en" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/brianp" title="brianp on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  </ul>
</nav>
 </div>
            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/side-column-bg.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://alwayscoding.ca//" title="link to homepage for { always: &#39;coding&#39; }"> <img src="http://www.gravatar.com/avatar/c15ec5b29cc5407a01bd17907e41230b?s=160" width="80" alt="{ always: &#39;coding&#39; } logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://alwayscoding.ca//"  title="link to homepage for { always: &#39;coding&#39; }">{ always: &#39;coding&#39; }</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  Brian Pearce  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                                <li class="navigation__item"><a href="http://alwayscoding.ca//#blog" title="link to { always: &#39;coding&#39; } blog" class="blog-button">Blog</a> </li></br>
                                
                                
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/brian_pearce" title="@brian_pearce on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="http://no.linkedin.com/in/brian-pearce/en" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/brianp" title="brianp on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

        <div class="content-wrapper">
            <div class="content-wrapper__inner">
                <div class="post">
                    <h1>Cross compilation to OSX with Rust</h1>
                    <span class="post-date">Sun, May 8, 2016</span>
                    




<p>It started with <a href="http://github.com/brianp/muxed">Muxed</a>. I was excited to get a working first build, but despite my development machine being a MacBook Air, I develop most in VM&rsquo;s using vagrant. My native builds were all linux based. It would be easy enough to move the code to an OSX machine and compile there but I do not like build tools on my native machine. And that would simply be too easy.</p>

<p>Overall documentation on the complete process did not seem readily available. So there was a lot of question-asking, googling, and piecing together differents parts of solutions.</p>

<p>Let&rsquo;s meet <code>Rustup</code> and deal with some disambiguation.  The original <code>Rustup</code> was a <a href="https://static.rust-lang.org/rustup.sh">bash script</a> to help install the rust compiler. Since then the name has been re-purposed and now become the <a href="https://github.com/rust-lang-nursery/rustup.rs">Rust toolchain installer</a>. The new <code>Rustup</code> offers us the beginning of support for <a href="https://github.com/rust-lang-nursery/rustup.rs#cross-compilation">cross compilation</a>.</p>

<p><strong>But today we are focusing on a pre Rustup Toolchain cross compilation build process.</strong></p>

<p>Let&rsquo;s layout some assumptions and dependencies before we start:</p>

<p>This guide unfortunately requires two systems to build the first time but a single system to continue cross compiling from. It is possible to do with Unix only, but I could not make it work. Assume all instructions are being executed on the Unix system unless otherwise noted.</p>

<ul>
<li>Ubuntu 15.10 Wily Werewolf (Inside Vagrant/VirtualBox)</li>
<li>Mac OSX 10.9.5</li>
</ul>

<p>Build tools on Ubuntu:</p>

<ul>
<li>curl</li>
<li>git</li>
<li>autotools-dev</li>
<li>automake</li>
<li>cmake</li>
<li>clang</li>
</ul>

<h3 id="step-1-install-the-stdlib">Step 1. Install the stdlib</h3>

<p>To cross compile you require the compiled <code>stdlib</code> for the architecture type you want to compile to. You will want to get the same <code>stdlib</code> as the version of <code>rustc</code> you are running. If <code>rustc -v</code> outputs <code>1.10</code> then you want <code>stdlib 1.10</code>. Luckily the Rust community makes these readily available for you. Head on over to <a href="https://static.rust-lang.org/dist/index.html">the distribution directoy</a> and find the package you&rsquo;re looking for based on architecture type, and version.</p>

<p>In our case it will be: <code>rust-std-1.10.0-x86_64-apple-darwin</code>.</p>

<p>Now fetch this package on to the unix system, untar it, and install it. Its location does not matter much and is not required to be in your project:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>$ wget https://static.rust-lang.org/dist/rust-std-1.10.0-x86_64-apple-darwin.tar.gz
$ tar -xvxf rust-std-1.10.0-x86_64-apple-darwin
$ <span style="color: #007020">cd</span> rust-std-1.10.0-x86_64-apple-darwin
$ sudo ./install.sh
install: installing component <span style="background-color: #fff0f0">&#39;rust-std-x86_64-apple-darwin&#39;</span>

   std is standing at the ready.
</pre></div>

<h3 id="step-2-acquire-an-xcode-package">Step 2. Acquire an Xcode Package</h3>

<p><strong>Note:</strong> If you will be performing step 3 on an OSX system, and already have xcode installed, you can skip this step.</p>

<p>Download Xcode. This will require an apple developer login. An active subscription is <strong>not required</strong>.</p>

<p>The version of Xcode required at the time of writing is 7.3. You can find links to all the available versions of Xcode <a href="https://stackoverflow.com/questions/10335747/how-to-download-xcode-4-5-6-7-and-get-the-dmg-file#10335943">here</a>.</p>

<h3 id="step-3-package-the-sdk">Step 3. Package the SDK</h3>

<p>This is the part where you may deviate if desired.</p>

<p><a href="https://github.com/tpoechtrager/osxcross">OSXCross</a> has an entire <a href="https://github.com/tpoechtrager/osxcross#packaging-the-sdk">section</a> on how to package the sdk for different OSX versions, while on different systems. Like I mentioned before, I could not manage sdk extraction on Unix, and ended up having to do this part on OSX.</p>

<p>If you do not already have Xcode installed on your OSX system, install your chosen package.</p>

<p>Clone the OSXCross repo to your OSX system, move into its directory, and call the extraction tool:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>$ git clone git@github.com:tpoechtrager/osxcross.git
$ <span style="color: #007020">cd</span> osxcross
$ ./tools/gen_sdk_package.sh
</pre></div>

<p>My system output two packages: <code>MacOSX10.10.sdk.tar.xz</code> and <code>MacOSX10.9.sdk.tar.xz</code>.</p>

<p>Copy the desired package to your Unix system. I moved <code>MacOSX10.10.sdk.tar.xz</code> to the homdir on my Unix VM.</p>

<h3 id="step-4-install-osxcross">Step 4. Install OSXCross</h3>

<p>Now we also need OSXCross on the Unix system. And we need to move the <code>MacOSX10.10.sdk.tar.xz</code> package into osxcross&rsquo; <code>tarballs</code> directory.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>$ git clone git@github.com:tpoechtrager/osxcross.git
$ <span style="color: #007020">cd</span> osxcross
$ mv ~/MacOSX10.10.sdk.tar.xz ./tarballs
</pre></div>

<p>Now we install OSXCross:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>$ <span style="color: #996633">OSX_VERSION_MIN</span><span style="color: #333333">=</span>10.7 ./build.sh

&gt; All <span style="color: #008800; font-weight: bold">done</span>! Now you can use o32-clang<span style="color: #333333">(</span>++<span style="color: #333333">)</span> and o64-clang<span style="color: #333333">(</span>++<span style="color: #333333">)</span> like a normal compiler.

&gt; <span style="color: #333333">(</span>more output<span style="color: #333333">)</span>…
</pre></div>

<p>As OSXCross will remind you, we also need to add the linkers to your path:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>Do not forget to add

/home/vagrant/osxcross/target/bin

to your PATH variable.
</pre></div>

<h3 id="step-5-add-the-target-to-cargo">Step 5. Add the target to Cargo</h3>

<p>I read this wrong. <strong>So. Many. Times.</strong> So let&rsquo;s be careful here.</p>

<p>We are going to add the linker in our cargo <em>config</em>. This is the configuration for cargo. <em>Not</em> the Cargo.toml for your project.</p>

<p>The configuration file can be in any project, or subdirectory of the project. Cargo will recursively look for a <code>.cargo/config</code> file.</p>

<p>Add the following:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #333333">[</span>target.x86_64-apple-darwin<span style="color: #333333">]</span>
<span style="color: #996633">linker</span> <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;x86_64-apple-darwin14-clang&quot;</span>

<span style="color: #333333">[</span>target.x86_64-unknown-linux-gnu<span style="color: #333333">]</span>
</pre></div>

<p>This tells cargo which linker to use for the defined target.</p>

<p>Not defining a linker for the <code>linux-gnu</code> target sets it to use the default system.</p>

<h3 id="step-6-cross-compile-time">Step 6. Cross Compile Time!</h3>

<p>Assuming you have made it this far you can now cross compile. Head to your project
root and run cargo with the <code>--target</code> option, where the value matches the target
in the Cargo config:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>$ cargo build --target x86_64-apple-darwin
</pre></div>

<p>Success! You hopefully just cross compiled your application or library!</p>

<p><img src="http://alwayscoding.ca/images/posts/kermit-dance-osxcross.gif" alt="Kermit the frog doing a happy dance!" title="Kermit the frog doing a happy dance!" /></p>

                </div>
            </div>
        </div>
    </body>
    
</html>
