<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
      <title>Activerecord on { always: &#39;coding&#39; } </title>
      <generator uri="https://gohugo.io">Hugo</generator>
    <link>https://brianp.github.io/alwayscoding.ca/tags/activerecord/</link>
    <language>en-us</language>
    
    
    <updated>Tue, 05 Jun 2012 00:00:00 UTC</updated>
    
    <item>
      <title>Transactions and new_record?</title>
      <link>https://brianp.github.io/alwayscoding.ca/2012/06/05/transactions-and-new-record/</link>
      <pubDate>Tue, 05 Jun 2012 00:00:00 UTC</pubDate>
      
      <guid>https://brianp.github.io/alwayscoding.ca/2012/06/05/transactions-and-new-record/</guid>
      <description>&lt;p&gt;While working with the ActiveRecord method &amp;lsquo;new_record?&amp;rsquo; and Transactions I
ran into an odd issue after I had run a few objects through a Transaction. Although the
transaction had rolled back and thus not saving the record, running &amp;lsquo;object_instance.new_record?&amp;rsquo; resulted
in a return of false as if the record had been saved to the database.&lt;/p&gt;

&lt;p&gt;I also found the same issue recorded here:
&lt;a href=&#34;http://squarewheel.wordpress.com/2008/06/11/new_record/&#34; title=&#34;New Record&#34;&gt;http://squarewheel.wordpress.com/2008/06/11/new_record/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is example code where the error will happen. Tested with Rails 3.1.0 &amp;amp;
ActiveRecord 3.1.0&lt;/p&gt;

&lt;p&gt;For this example I generated a new project&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;rails new rollback
rails g model Cat name:string purrr:string age:integer lives_left:integer
rake db:migrate
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then I can kick up a console session:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Cat&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;transaction &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;do&lt;/span&gt;
  &lt;span style=&#34;color: #3333BB&#34;&gt;@cat&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Cat&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;new(&lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;Professor Wellington&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;purrr&lt;/span&gt;: &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;meooow&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;age&lt;/span&gt;: &lt;span style=&#34;color: #0000DD; font-weight: bold&#34;&gt;17&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;lives_left&lt;/span&gt;: &lt;span style=&#34;color: #0000DD; font-weight: bold&#34;&gt;6&lt;/span&gt;)
  &lt;span style=&#34;color: #3333BB&#34;&gt;@cat&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;save
  &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Exception&lt;/span&gt;
&lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;#=&amp;gt; throws a big error&lt;/span&gt;

&lt;span style=&#34;color: #3333BB&#34;&gt;@cat&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;persisted?
&lt;span style=&#34;color: #888888&#34;&gt;#=&amp;gt; true&lt;/span&gt;
&lt;span style=&#34;color: #3333BB&#34;&gt;@cat&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;new_record?
&lt;span style=&#34;color: #888888&#34;&gt;#=&amp;gt; false&lt;/span&gt;
&lt;span style=&#34;color: #3333BB&#34;&gt;@cat&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;inspect
&lt;span style=&#34;color: #888888&#34;&gt;#=&amp;gt; &amp;lt;Cat id: 1, name: \&amp;quot;Professor Wellington\&amp;quot;, purrr: &amp;#39;meooow&amp;#39;, age:&lt;/span&gt;
&lt;span style=&#34;color: #0000DD; font-weight: bold&#34;&gt;17&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;lives_left&lt;/span&gt;: &lt;span style=&#34;color: #0000DD; font-weight: bold&#34;&gt;6&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;created_at&lt;/span&gt;: \&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;quot;2013-02-02 00:20:44&lt;/span&gt;&lt;span style=&#34;color: #666666; font-weight: bold; background-color: #fff0f0&#34;&gt;\&amp;quot;&lt;/span&gt;&lt;span style=&#34;background-color: #fff0f0&#34;&gt;, updated_at: &lt;/span&gt;&lt;span style=&#34;color: #666666; font-weight: bold; background-color: #fff0f0&#34;&gt;\&amp;quot;&lt;/span&gt;&lt;span style=&#34;background-color: #fff0f0&#34;&gt;2013-02-02 00:20:44&lt;/span&gt;&lt;span style=&#34;color: #666666; font-weight: bold; background-color: #fff0f0&#34;&gt;\&amp;quot;&lt;/span&gt;&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&#34;background-color: #fff0f0&#34;&gt;Cat.count&lt;/span&gt;
&lt;span style=&#34;background-color: #fff0f0&#34;&gt;#=&amp;gt; 0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So even though the Professor was never actually saved to the database
the ruby model acts as if it has been.&lt;/p&gt;

&lt;p&gt;I didn&amp;rsquo;t revisit the issue until publishing this post (the current date
is Feb 1, 2013) and have since found that in Rails 3.1.10 the issue has
been resolved. I don&amp;rsquo;t know at what patch level the fix happend but it
is no longer an issue.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Saving Unique Twitter ID&#39;s &amp;amp; MySQL Integers</title>
      <link>https://brianp.github.io/alwayscoding.ca/2011/02/12/saving-unique-twitter-ids-and-mysql-integers/</link>
      <pubDate>Sat, 12 Feb 2011 00:00:00 UTC</pubDate>
      
      <guid>https://brianp.github.io/alwayscoding.ca/2011/02/12/saving-unique-twitter-ids-and-mysql-integers/</guid>
      <description>&lt;p&gt;TLDR; Don&amp;rsquo;t store Tweet ID&amp;rsquo;s as INT. Use BIGINT.&lt;/p&gt;

&lt;p&gt;While writing a Twitter application in Rails I was having an issue saving tweets to the database.&lt;/p&gt;

&lt;p&gt;A quick brief on the application: The app would download tweets from the mention timeline of a particular user. It would only download tweets it hadn&amp;rsquo;t already processed based on the last saved tweets unique id (as set by twitter). All the data from the tweets were making it into the database as expected but every time the application downloaded tweets it would re-download the same tweets.&lt;/p&gt;

&lt;p&gt;After being quite perplexed for a period of time and trying many different solutions I realized that Twitters unique tweet ID did not match the tweet_id being stored locally. This was caused by the sheer size of Twitters id number. I was storing it as an INT which can only go
up to 2147483647 (MySQL). Where Twitters current tweet id&amp;rsquo;s reside in around 36331797625184256.&lt;/p&gt;

&lt;p&gt;I would need to use MySQL&amp;rsquo;s BIGINT which can go up to 9223372036854775807 to be able to save the id as a number.&lt;/p&gt;

&lt;p&gt;Unfortunately BIGINT ins&amp;rsquo;t a standard type to set via rails migrations.
As per this post by &lt;a href=&#39;http://spin.atomicobject.com/2011/05/19/ruby-on-rails-and-mysql-bigint/&#39;&gt;Dustin Tinney - Ruby on Rails &amp;amp; MYSQL BIGINT&lt;/a&gt; the proper way to use big int is to create a regular integer column via migrations and the change the column to BIGINT.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #BB0066; font-weight: bold&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #0066BB; font-weight: bold&#34;&gt;up&lt;/span&gt;
  create_table(&lt;span style=&#34;color: #AA6600&#34;&gt;:people&lt;/span&gt;) &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;t&lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;
    t&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;integer &lt;span style=&#34;color: #AA6600&#34;&gt;:number_of_facebook_friends&lt;/span&gt;
  &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;

  change_column &lt;span style=&#34;color: #AA6600&#34;&gt;:people&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;:number_of_facebook_friends&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;:bigint&lt;/span&gt;
&lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
